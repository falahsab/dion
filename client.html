<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>كشف حساب العميل</title>

<style>
    body {
        font-family: "Tajawal", sans-serif;
        background: #f1f5f9;
        padding: 20px;
    }

    .card {
        max-width: 600px;
        margin: auto;
        background: white;
        padding: 25px;
        border-radius: 15px;
        box-shadow: 0 4px 12px #0001;
    }

    h2, h3 { margin: 10px 0; color: #0f172a; }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
    }

    th, td {
        border-bottom: 1px solid #e5e7eb;
        padding: 10px;
        text-align: center;
    }

    th {
        background: #f8fafc;
        font-weight: bold;
    }

    .credit { color: green; font-weight: bold; }
    .debit { color: red; font-weight: bold; }
</style>
</head>

<body>

<div class="card">
    <h2 id="clientName"></h2>
    <h3>إجمالي الحساب: <span id="total"></span> ريال</h3>

    <table id="table">
    </table>
</div>

<script>
const API = "https://script.google.com/macros/s/AKfycbxRa_PLC_aO0EeWQBrNV7NXVoh6yb4ZlZrHz1o8oyhcu2QjXAac53Bjh3BKp8PIublL/exec";

if (!localStorage.getItem("client_id")) {
    alert("يرجى تسجيل الدخول أولاً");
    window.location = "index.html";
}

document.getElementById("clientName").innerText =
    "كشف حساب: " + localStorage.getItem("client_name");

loadClient();

async function loadClient() {
    let res = await fetch(API, {
        method: "POST",
        body: JSON.stringify({
            action: "getClientData",
            client_id: localStorage.getItem("client_id")
        })
    });

    let data = await res.json();
    document.getElementById("total").innerText = data.total;

    let html = `
        <tr>
            <th>التاريخ</th>
            <th>النوع</th>
            <th>المبلغ</th>
            <th>البيان</th>
        </tr>
    `;

    data.list.forEach(r => {
        html += `
        <tr>
            <td>${new Date(r.date).toLocaleDateString()}</td>
            <td class="${r.type}">${r.type === 'credit' ? 'له' : 'عليه'}</td>
            <td class="${r.type}">${r.amount}</td>
            <td>${r.note}</td>
        </tr>`;
    });

    document.getElementById("table").innerHTML = html;
}
</script>

</body>
</html>
